<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Eternal Brothers FC</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

<!-- Firebase config -->
<script src="firebase-config.js"></script>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
import { getDatabase, ref, push, onValue, set } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";

// ÿ™ŸáŸäÿ¶ÿ© Firebase
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// ====== Chat ÿ£ŸàŸÜŸÑÿßŸäŸÜ ======
let chatEnabled = false;
let chatNameGlobal = "";
const chatBox = document.getElementById('chatBox');

function enableChat() {
  const name = document.getElementById('chatName').value.trim();
  if(!name) return alert("Please enter your name");
  chatEnabled = true;
  chatNameGlobal = name;
  document.getElementById('chatInput').disabled = false;
  document.getElementById('sendBtn').disabled = false;
}

function sendMessage() {
  if(!chatEnabled) return alert("Enable chat first");
  const text = document.getElementById('chatInput').value.trim();
  if(!text) return;
  push(ref(db,'messages'), {name: chatNameGlobal, text: text, time: Date.now()});
  document.getElementById('chatInput').value = "";
  document.getElementById('sendSound').play();
}

// ÿπÿ±ÿ∂ ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ ŸÅŸàÿ±Ÿãÿß ŸÑŸÉŸÑ ÿßŸÑÿ£ÿ¨Ÿáÿ≤ÿ©
onValue(ref(db,'messages'), snapshot=>{
  const data = snapshot.val() || {};
  chatBox.innerHTML="";
  for(let key in data){
    const msg = data[key];
    const time = new Date(msg.time).toLocaleString('en-US',{hour12:true});
    const div = document.createElement('div');
    div.innerHTML=`<span style="color:blue">${msg.name}</span>: ${msg.text} <span class="message-time">(${time})</span>`;
    div.style.padding='4px 2px';
    chatBox.appendChild(div);
  }
  chatBox.scrollTop = chatBox.scrollHeight;
});

// ====== Teams ÿ£ŸàŸÜŸÑÿßŸäŸÜ ======
const teamsRef = ref(db,'teams');
const maxTeamSize = 12;

// Utility: ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ŸÅŸä ÿßŸÑŸàÿßÿ¨Ÿáÿ©
function renderTeamList(listId, listData){
  const ul = document.getElementById(listId);
  ul.innerHTML="";
  listData.forEach((p,i)=>{
    const time = new Date(p.time).toLocaleString('en-US',{hour12:true});
    const li = document.createElement('li');
    li.innerHTML=`${i+1}. ${p.name} (${time}) <span style="cursor:pointer;color:red;" onclick="deletePlayer('${listId}',${i})">üóëÔ∏è</span>`;
    ul.appendChild(li);
  });
}

// ÿ•ÿ∂ÿßŸÅÿ© ŸÑÿßÿπÿ® ÿ£ŸàŸÜŸÑÿßŸäŸÜ
function addPlayer(teamType){
  const inputId = teamType==="main" ? 'nameInput' : teamType==="blue" ? 'blueInput' : 'yellowInput';
  const name = document.getElementById(inputId).value.trim();
  if(!name) return alert("Name cannot be empty");

  onValue(teamsRef, snapshot=>{
    const data = snapshot.val() || {main:[],waiting:[],blue:[],yellow:[]};
    let teamArr = teamType==="main" ? data.main : teamType==="blue" ? data.blue : data.yellow;
    if(teamArr.find(p=>p.name===name)) return alert("Already exists in this team");
    if(teamArr.length>=maxTeamSize && teamType!=="main") return alert(teamType+" team full");
    if(teamType==="main" && teamArr.length>=24){
      data.waiting.push({name,time:Date.now()});
    } else {
      teamArr.push({name,time:Date.now()});
    }
    set(teamsRef,data);
    document.getElementById(inputId).value="";
  },{onlyOnce:true});
}

// ÿ≠ÿ∞ŸÅ ŸÑÿßÿπÿ® ÿ£ŸàŸÜŸÑÿßŸäŸÜ
function deletePlayer(listId,index){
  if(!confirm("Delete this player?")) return;
  onValue(teamsRef, snapshot=>{
    const data = snapshot.val() || {main:[],waiting:[],blue:[],yellow:[]};
    let arr;
    if(listId==="teamList") arr=data.main;
    else if(listId==="waitingList") arr=data.waiting;
    else if(listId==="blueList") arr=data.blue;
    else if(listId==="yellowList") arr=data.yellow;
    arr.splice(index,1);
    set(teamsRef,data);
  },{onlyOnce:true});
}

// ÿßŸÑÿßÿ≥ÿ™ŸÖÿßÿπ ŸÑÿ™ÿ≠ÿØŸäÿ´ÿßÿ™ ÿßŸÑŸÅÿ±ŸÇ
onValue(teamsRef, snapshot=>{
  const data = snapshot.val() || {main:[],waiting:[],blue:[],yellow:[]};
  renderTeamList("teamList",data.main);
  renderTeamList("waitingList",data.waiting);
  renderTeamList("blueList",data.blue);
  renderTeamList("yellowList",data.yellow);
});

window.enableChat = enableChat;
window.sendMessage = sendMessage;
window.addMember = ()=>addPlayer("main");
window.addBlue = ()=>addPlayer("blue");
window.addYellow = ()=>addPlayer("yellow");
window.deletePlayer = deletePlayer;
</script>

<style>
/* ŸÉŸÑ CSS ŸÉŸÖÿß ŸáŸà ÿ≥ÿßÿ®ŸÇŸãÿß */
body { font-family: "Cairo", Arial, sans-serif; background-color: #121212; color: #e0e0e0; padding: 10px; text-align: center; margin:0;}
.nav-buttons { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
button { padding: 10px 16px; border: none; font-weight: 700; font-size: 15px; border-radius: 8px; cursor: pointer; width: 30%; max-width: 130px; }
#homeBtn { background:#d32f2f; color:#fff; }
#blueBtn { background:#1976d2; color:#fff; }
#yellowBtn { background:#fbc02d; color:#000; }
.container { max-width: 95%; margin: auto; background: #1e1e1ecc; padding: 20px 10px; border-radius: 15px; box-shadow: 0 0 10px #000; display: none; }
h1 { font-size: 20px; color: #d32f2f; margin-bottom: 5px; font-weight:bold; }
h1::before, h1::after { content: "‚öΩ"; margin: 0 6px; }
h2 { font-size: 20px; color: #fff; margin: 15px 0 8px; }
input[type=text], input[type=time] { padding: 10px; width: 80%; margin: 8px 0; border-radius: 8px; border: 1px solid #555; text-align: center; font-size: 15px; background-color: #2c2c2c; color: #fff; }
button.addBtn { padding: 8px 14px; margin: 6px; font-size: 14px; }
ul { list-style: none; padding: 0; text-align: left; margin-top: 10px; font-weight: bold; font-family: "Arial Black", Arial, sans-serif; }
li { margin: 6px 0; padding: 8px; border-radius: 12px; font-size: 15px; display:flex; justify-content: space-between; align-items: center; }
#teamList li { background: #a8e6a1; color:black; }
#waitingList li { background: #ffe0e0; color:black; }
#blueList li { background: rgba(25,118,210,0.7); color:black; }
#yellowList li { background: rgba(251,192,42,0.7); color:black; }
#chatBox { max-height: 300px; overflow-y: auto; background: #2c2c2c; padding: 10px; border-radius: 8px; margin-bottom: 10px; text-align: left; }
.message-time { font-size: 12px; color: #aaa; margin-left: 6px; }
</style>

<body>
<div class="nav-buttons">
  <button id="blueBtn" onclick="showSection('blue')">Blue</button>
  <button id="homeBtn" onclick="showSection('main')">Home</button>
  <button id="yellowBtn" onclick="showSection('yellow')">Yellow</button>
</div>

<div id="main" class="container">
  <h1>Eternal Brothers FC</h1>
  <div class="address-container">
    <span class="address-pin">üìç</span>
    <span id="matchAddress">Click here to set match address</span>
  </div>
  <div class="match-time">‚úîÔ∏è The match will be on Sunday at 9:40 AM</div>
  <div class="match-note">Please follow the group chat in case of any changes</div>

  <h2>Add Player to Main Team</h2>
  <input type="text" id="nameInput" placeholder="Enter player name">
  <button class="addBtn" onclick="addMember()">Add</button>

  <h2>Main Team List (24 players max)</h2>
  <ul id="teamList"></ul>

  <h2>Waiting List</h2>
  <ul id="waitingList"></ul>

  <h2>Team Chat</h2>
  <input type="text" id="chatName" placeholder="Enter your name to enable chat">
  <button class="addBtn" onclick="enableChat()">‚úîÔ∏è Confirm</button>
  <div id="chatBox"></div>
  <input type="text" id="chatInput" placeholder="Type your message..." style="width:80%;" disabled>
  <button class="addBtn" id="sendBtn" onclick="sendMessage()" disabled style="background:green;">Send</button>
  <button class="addBtn" style="background:#d32f2f; font-size:12px;" onclick="clearChat()">Clear Chat</button>
</div>

<!-- Blue Section -->
<div id="blue" class="container" style="background:#1565c0aa;">
  <h2>Blue Team üîµ</h2>
  <input type="text" id="blueInput" placeholder="Enter player name">
  <button class="addBtn" onclick="addBlue()">Add</button>
  <ul id="blueList"></ul>
</div>

<!-- Yellow Section -->
<div id="yellow" class="container" style="background:#fdd835aa; color:#000;">
  <h2>Yellow Team üü°</h2>
  <input type="text" id="yellowInput" placeholder="Enter player name">
  <button class="addBtn" onclick="addYellow()">Add</button>
  <ul id="yellowList"></ul>
</div>

<!-- Audio -->
<audio id="sendSound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>
<audio id="alarmSound" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg"></audio>
</body>
</html>
