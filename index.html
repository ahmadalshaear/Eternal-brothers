<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Eternal Brothers FC</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

<script type="module">
import { firebaseConfig } from './firebase-config.js';
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
import { getDatabase, ref, push, onValue, set } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// ===== Navigation =====
function showSection(id){
  document.querySelectorAll('.container').forEach(c=>c.style.display='none');
  document.getElementById(id).style.display='block';
}
document.addEventListener("DOMContentLoaded", ()=>showSection('main'));

// ===== Teams =====
const maxTeamSize=12;

function renderTeamList(listId, listData){
  const ul=document.getElementById(listId);
  ul.innerHTML="";
  listData.forEach((p,i)=>{
    const time=new Date(p.time).toLocaleTimeString();
    const li=document.createElement('li');
    li.innerHTML=`${i+1}. ${p.name} (${time}) <span style="cursor:pointer;color:red;" onclick="deletePlayer('${listId}',${i})">üóëÔ∏è</span>`;
    ul.appendChild(li);
  });
}

function addPlayer(teamType){
  const inputId=teamType==="main" ? 'nameInput' : teamType==="blue" ? 'blueInput' : 'yellowInput';
  const name=document.getElementById(inputId).value.trim();
  if(!name) return alert("Name cannot be empty");

  const teamRef = ref(db, 'teams');
  onValue(teamRef, snapshot=>{
    const data = snapshot.val() || { main:[], waiting:[], blue:[], yellow:[] };
    let arr = teamType==="main" ? data.main : teamType==="blue" ? data.blue : data.yellow;

    if(arr.find(p=>p.name===name)) return alert("Already exists");
    if(teamType!=="main" && arr.length>=maxTeamSize) return alert(teamType+" team full");
    if(teamType==="main" && arr.length>=24) data.waiting.push({name,time:Date.now()});
    else arr.push({name,time:Date.now()});

    set(teamRef,data);
    document.getElementById(inputId).value="";
  }, {onlyOnce:true});
}

function deletePlayer(listId,index){
  if(!confirm("Delete this player?")) return;
  const teamRef = ref(db, 'teams');
  onValue(teamRef, snapshot=>{
    const data = snapshot.val() || { main:[], waiting:[], blue:[], yellow:[] };
    let arr;
    if(listId==="teamList") arr=data.main;
    else if(listId==="waitingList") arr=data.waiting;
    else if(listId==="blueList") arr=data.blue;
    else if(listId==="yellowList") arr=data.yellow;

    arr.splice(index,1);
    set(teamRef,data);
  }, {onlyOnce:true});
}

onValue(ref(db,'teams'), snapshot=>{
  const data=snapshot.val()||{main:[],waiting:[],blue:[],yellow:[]};
  renderTeamList("teamList",data.main);
  renderTeamList("waitingList",data.waiting);
  renderTeamList("blueList",data.blue);
  renderTeamList("yellowList",data.yellow);
});

// ===== Chat =====
let chatEnabled=false;
let chatNameGlobal="";
const chatBox=document.getElementById('chatBox');

function enableChat(){
  const name=document.getElementById('chatName').value.trim();
  if(!name) return alert("Enter your name");
  chatEnabled=true;
  chatNameGlobal=name;
  document.getElementById('chatInput').disabled=false;
  document.getElementById('sendBtn').disabled=false;
}

function sendMessage(){
  if(!chatEnabled) return alert("Enable chat first");
  const text=document.getElementById('chatInput').value.trim();
  if(!text) return;
  push(ref(db,'messages'), {name:chatNameGlobal,text:text,time:Date.now()});
  document.getElementById('chatInput').value="";
}

onValue(ref(db,'messages'), snapshot=>{
  const data=snapshot.val()||{};
  chatBox.innerHTML="";
  for(let key in data){
    const msg=data[key];
    const div=document.createElement('div');
    div.innerHTML=`<strong>${msg.name}</strong>: ${msg.text}`;
    chatBox.appendChild(div);
  }
  chatBox.scrollTop=chatBox.scrollHeight;
}

// Make functions available to HTML
window.addMember=()=>addPlayer("main");
window.addBlue=()=>addPlayer("blue");
window.addYellow=()=>addPlayer("yellow");
window.enableChat=enableChat;
window.sendMessage=sendMessage;
window.deletePlayer=deletePlayer;

</script>

<style>
body { font-family: "Cairo", Arial, sans-serif; background:#121212; color:#fff; text-align:center; margin:0; padding:10px; }
.nav-buttons { display:flex; justify-content:space-between; margin-bottom:20px; }
button { padding:10px; border:none; border-radius:8px; cursor:pointer; width:30%; max-width:130px; }
#homeBtn{background:#d32f2f;color:#fff;} #blueBtn{background:#1976d2;color:#fff;} #yellowBtn{background:#fbc02d;color:#000;}
.container{display:none;max-width:95%;margin:auto;padding:20px 10px;background:#1e1e1ecc;border-radius:15px;box-shadow:0 0 10px #000;}
ul{list-style:none;padding:0;text-align:left;margin-top:10px;}
li{margin:6px 0;padding:8px;border-radius:12px;display:flex;justify-content:space-between;align-items:center;}
#teamList li{background:#a8e6a1;color:black;} #waitingList li{background:#ffe0e0;color:black;}
#blueList li{background:rgba(25,118,210,0.7);color:black;} #yellowList li{background:rgba(251,192,42,0.7);color:black;}
#chatBox{max-height:300px;overflow-y:auto;background:#2c2c2c;padding:10px;border-radius:8px;margin-bottom:10px;text-align:left;}
</style>
</head>
<body>

<div class="nav-buttons">
  <button id="blueBtn" onclick="showSection('blue')">Blue</button>
  <button id="homeBtn" onclick="showSection('main')">Home</button>
  <button id="yellowBtn" onclick="showSection('yellow')">Yellow</button>
</div>

<div id="main" class="container">
  <h1>Eternal Brothers FC</h1>
  <h2>Add Player to Main Team</h2>
  <input type="text" id="nameInput" placeholder="Enter player name">
  <button onclick="addMember()">Add</button>

  <h2>Main Team</h2>
  <ul id="teamList"></ul>
  <h2>Waiting List</h2>
  <ul id="waitingList"></ul>

  <h2>Chat</h2>
  <input type="text" id="chatName" placeholder="Enter name to enable chat">
  <button onclick="enableChat()">‚úîÔ∏è Confirm</button>
  <div id="chatBox"></div>
  <input type="text" id="chatInput" placeholder="Type message..." disabled>
  <button id="sendBtn" onclick="sendMessage()" disabled>Send</button>
</div>

<div id="blue" class="container" style="background:#1565c0aa;">
<h2>Blue Team üîµ</h2>
<input type="text" id="blueInput" placeholder="Enter player name">
<button onclick="addBlue()">Add</button>
<ul id="blueList"></ul>
</div>

<div id="yellow" class="container" style="background:#fdd835aa;color:#000;">
<h2>Yellow Team üü°</h2>
<input type="text" id="yellowInput" placeholder="Enter player name">
<button onclick="addYellow()">Add</button>
<ul id="yellowList"></ul>
</div>

</body>
</html>
