<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Eternal Brothers FC</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body {
  font-family: "Cairo", sans-serif;
  background-color: #121212;
  color: #e0e0e0;
  margin:0;
  padding:10px;
  text-align:center;
}
.nav-buttons {
  display:flex;
  justify-content:space-between;
  margin-bottom:20px;
}
button {
  padding:10px 16px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:700;
}
#homeBtn { background:#d32f2f; color:#fff; }

.container {
  display:none;
  max-width:95%;
  margin:auto;
  background:#1e1e1ecc;
  padding:20px 10px;
  border-radius:15px;
  box-shadow:0 0 10px #000;
}
h1,h2,h3 { margin:10px 0; }
input[type=text] { padding:8px; width:80%; border-radius:8px; border:1px solid #555; margin:5px 0; background:#2c2c2c; color:#fff; text-align:center; }
ul { list-style:none; padding:0; margin-top:10px; text-align:left; font-weight:bold; }
li { margin:5px 0; padding:6px; border-radius:8px; display:flex; justify-content:space-between; align-items:center; }
#teamList li { background:#a8e6a1; color:black; }
#waitingList li { background:#ffe0e0; color:black; }

#chatBox { max-height:300px; overflow-y:auto; background:#2c2c2c; padding:10px; border-radius:8px; margin-bottom:10px; text-align:left; }
</style>
</head>
<body>

<div class="nav-buttons">
  <button id="homeBtn" onclick="showSection('main')">Home</button>
</div>

<div id="main" class="container">
  <h1>Eternal Brothers FC</h1>
  <h2>Add Player</h2>
  <input type="text" id="nameInput" placeholder="Enter player name">
  <button onclick="addPlayer()">Add</button>

  <h2>Main Team (24 max)</h2>
  <ul id="teamList"></ul>

  <h2>Waiting List</h2>
  <ul id="waitingList"></ul>

  <h2>Chat</h2>
  <input type="text" id="chatName" placeholder="Enter your name">
  <button onclick="enableChat()">✔️ Confirm</button>
  <div id="chatBox"></div>
  <input type="text" id="chatInput" placeholder="Type message..." disabled>
  <button id="sendBtn" onclick="sendMessage()" disabled>Send</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const supabaseUrl = "https://wihhlvgkjglphjzhivdn.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndpaGhsdmdramdscGhqemhpdmRuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI5NDMwOTYsImV4cCI6MjA3ODUxOTA5Nn0.0uG2yhtSzNiGfn3f1ZjB0p33lMh75Et28aMgMGznWlQ";
const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

let chatEnabled=false;

// Navigation
function showSection(id){
  document.querySelectorAll('.container').forEach(c=>c.style.display='none');
  document.getElementById(id).style.display='block';
}
showSection('main');

// التحقق الزمني: الأربعاء 3 ظهراً إلى الأحد 12 ظهراً
function canAddPlayer() {
  const now = new Date();
  const day = now.getDay(); // 0=Sun,1=Mon,...,3=Wed,...6=Sat
  const hour = now.getHours();

  return (
    // الأربعاء بعد 3 ظهراً
    (day === 3 && hour >= 15) ||
    // الخميس الجمعة السبت كامل اليوم
    (day >= 4 && day <= 6) ||
    // الأحد قبل 12 ظهراً
    (day === 0 && hour < 12)
  );
}

// Main team
async function addPlayer(){
  if(!canAddPlayer()) return alert("يمكنك إضافة اللاعبين فقط من الأربعاء 3 ظهراً إلى الأحد 12 ظهراً.");
  const name = document.getElementById("nameInput").value.trim();
  if(!name) return alert("Enter a name");

  const { data: team } = await supabase.from("main_team").select("id");
  if(team.length < 24){
    const { error } = await supabase.from("main_team").insert([{name,time:Date.now()}]);
    if(error) return alert(error.message);
  } else {
    const { error } = await supabase.from("waiting_list").insert([{name,time:Date.now()}]);
    if(error) return alert(error.message);
    alert("Main team is full (24). Player added to waiting list.");
  }
  document.getElementById("nameInput").value="";
  loadPlayers();
}

async function loadPlayers(){
  const { data: team } = await supabase.from("main_team").select("*").order("id");
  const { data: waiting } = await supabase.from("waiting_list").select("*").order("id");
  const teamList = document.getElementById("teamList");
  const waitingList = document.getElementById("waitingList");
  teamList.innerHTML="";
  waitingList.innerHTML="";
  if(team) team.forEach((p,i)=>teamList.innerHTML+=`<li>${i+1}. ${p.name}</li>`);
  if(waiting) waiting.forEach((p,i)=>waitingList.innerHTML+=`<li>${i+1}. ${p.name}</li>`);
}

// Chat
function enableChat(){
  const name=document.getElementById('chatName').value.trim();
  if(!name) return alert("Enter your name");
  chatEnabled=true;
  document.getElementById('chatInput').disabled=false;
  document.getElementById('sendBtn').disabled=false;
}
async function sendMessage(){
  if(!chatEnabled) return;
  const name=document.getElementById('chatName').value.trim();
  const text=document.getElementById('chatInput').value.trim();
  if(!text) return;
  await supabase.from("chat").insert([{name,text,time:Date.now()}]);
  document.getElementById('chatInput').value="";
  loadChat();
}
async function loadChat(){
  const { data } = await supabase.from("chat").select("*").order("time");
  const box = document.getElementById("chatBox");
  box.innerHTML="";
  if(data) data.forEach(m=>{ box.innerHTML+=`<div><b>${m.name}:</b> ${m.text}</div>` });
}

// Load all
loadPlayers();
loadChat();
</script>

</body>
</html>
