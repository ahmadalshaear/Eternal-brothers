<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Eternal Brothers FC</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body { font-family: "Cairo", Arial, sans-serif; background:#121212; color:#e0e0e0; padding:10px; text-align:center; margin:0; }
.nav-buttons { display:flex; justify-content:space-between; margin-bottom:20px; }
button { padding:10px 16px; border:none; font-weight:700; font-size:15px; border-radius:8px; cursor:pointer; width:30%; max-width:130px; }
#homeBtn { background:#d32f2f; color:#fff; }
#blueBtn { background:#1976d2; color:#fff; }
#yellowBtn { background:#fbc02d; color:#000; }
.container { max-width:95%; margin:auto; background:#1e1e1ecc; padding:20px 10px; border-radius:15px; box-shadow:0 0 10px #000; display:none; }
h1 { font-size:20px; color:#d32f2f; margin-bottom:5px; font-weight:bold; }
input[type=text] { padding:10px; width:80%; margin:8px 0; border-radius:8px; border:1px solid #555; text-align:center; font-size:15px; background-color:#2c2c2c; color:#fff; }
.addBtn { padding:8px 14px; margin:6px; font-size:14px; }
ul { list-style:none; padding:0; text-align:left; margin-top:10px; font-weight:bold; font-family:"Arial Black", Arial, sans-serif; }
li { margin:6px 0; padding:8px; border-radius:12px; font-size:15px; display:flex; justify-content:space-between; align-items:center; }
#teamList li { background:#a8e6a1; color:black; }
#blueList li { background:rgba(25,118,210,0.7); color:black; }
#yellowList li { background:rgba(251,192,42,0.7); color:black; }
#chatBox { max-height:300px; overflow-y:auto; background:#2c2c2c; padding:10px; border-radius:8px; margin-bottom:10px; text-align:left; }
.field { width:100%; max-width:400px; height:250px; background:#4CAF50; margin:10px auto 20px auto; border:2px solid #fff; border-radius:10px; position:relative; touch-action:none; }
.field .center-circle, .field .penalty-box-left, .field .penalty-box-right, .field .mid-line { position:absolute; border:2px solid #fff; content:""; }
.field .center-circle { width:50px; height:50px; border-radius:50%; top:50%; left:50%; transform:translate(-50%,-50%); }
.field .penalty-box-left { width:60px; height:120px; top:50%; left:0; transform:translateY(-50%); }
.field .penalty-box-right { width:60px; height:120px; top:50%; right:0; transform:translateY(-50%); }
.field .mid-line { width:0; height:100%; border-left:2px solid #fff; top:0; left:50%; transform:translateX(-50%); }
.player-marker { width:35px; height:35px; border-radius:50%; color:#fff; display:flex; align-items:center; justify-content:center; font-size:14px; font-weight:bold; position:absolute; cursor:grab; user-select:none; text-align:center; }
.player-name { position:absolute; width:100px; text-align:center; left:-30px; top:-20px; font-size:12px; color:#fff; }
@media (max-width:500px){ button { width:28%; font-size:14px; } input[type=text]{ width:90%; font-size:14px; } }
</style>
</head>
<body>

<div class="nav-buttons">
  <button id="blueBtn" onclick="showSection('blue')">Blue</button>
  <button id="homeBtn" onclick="showSection('main')">Home</button>
  <button id="yellowBtn" onclick="showSection('yellow')">Yellow</button>
</div>

<div id="main" class="container">
  <h1>Eternal Brothers FC</h1>
  <h2>Add Player</h2>
  <input type="text" id="nameInput" placeholder="Enter player name">
  <button class="addBtn" onclick="addPlayer('main')">Add</button>
  <h2>Main Team</h2>
  <ul id="teamList"></ul>
  <h2>Chat</h2>
  <input type="text" id="chatName" placeholder="Enter your name">
  <button class="addBtn" onclick="enableChat()">✔️ Confirm</button>
  <div id="chatBox"></div>
  <input type="text" id="chatInput" placeholder="Type message..." disabled>
  <button class="addBtn" id="sendBtn" onclick="sendMessage()" disabled style="background:green;">Send</button>
</div>

<div id="blue" class="container" style="background:#1565c0aa;">
  <h2>Blue Team</h2>
  <input type="text" id="blueInput" placeholder="Enter player name">
  <button class="addBtn" onclick="addPlayer('blue')">Add</button>
  <ul id="blueList"></ul>
  <h3>Blue Plan</h3>
  <div id="bluePlan" class="field"></div>
</div>

<div id="yellow" class="container" style="background:#fdd835aa; color:#000;">
  <h2>Yellow Team</h2>
  <input type="text" id="yellowInput" placeholder="Enter player name">
  <button class="addBtn" onclick="addPlayer('yellow')">Add</button>
  <ul id="yellowList"></ul>
  <h3>Yellow Plan</h3>
  <div id="yellowPlan" class="field"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
// --- ضع معلوماتك هنا ---
const SUPABASE_URL = "YOUR_SUPABASE_URL";
const SUPABASE_ANON_KEY = "YOUR_SUPABASE_ANON_KEY";
const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// --- Navigation ---
function showSection(id){ document.querySelectorAll('.container').forEach(c=>c.style.display='none'); document.getElementById(id).style.display='block'; }
showSection('main');

// --- Players ---
async function addPlayer(team){
  let name = (team==='main') ? document.getElementById('nameInput').value.trim() :
             (team==='blue') ? document.getElementById('blueInput').value.trim() :
             document.getElementById('yellowInput').value.trim();
  if(!name) return alert("Enter name");
  await supabase.from('players').insert([{name,team,timestamp:new Date().toISOString()}]);
  renderPlayers();
}
async function renderPlayers(){
  const {data} = await supabase.from('players').select('*');
  document.getElementById('teamList').innerHTML = data.filter(p=>p.team==='main').map((p,i)=>`<li>${i+1}. ${p.name}</li>`).join('');
  document.getElementById('blueList').innerHTML = data.filter(p=>p.team==='blue').map((p,i)=>`<li>${i+1}. ${p.name}</li>`).join('');
  document.getElementById('yellowList').innerHTML = data.filter(p=>p.team==='yellow').map((p,i)=>`<li>${i+1}. ${p.name}</li>`).join('');
}
supabase.from('players').on('INSERT',()=>renderPlayers()).subscribe();
renderPlayers();

// --- Chat ---
let chatEnabled=false;
function enableChat(){ chatEnabled=true; document.getElementById('chatInput').disabled=false; document.getElementById('sendBtn').disabled=false; }
async function sendMessage(){
  if(!chatEnabled) return;
  const name=document.getElementById('chatName').value.trim();
  const text=document.getElementById('chatInput').value.trim();
  if(!text) return;
  await supabase.from('chat').insert([{name,text,timestamp:new Date().toISOString()}]);
  document.getElementById('chatInput').value="";
  renderChat();
}
async function renderChat(){
  const {data} = await supabase.from('chat').select('*').order('timestamp',{ascending:true});
  document.getElementById('chatBox').innerHTML = data.map(m=>`<div><b>${m.name}:</b> ${m.text}</div>`).join('');
}
supabase.from('chat').on('INSERT',()=>renderChat()).subscribe();
renderChat();

// --- Plans (Draggable) ---
async function createPlan(teamList, planDivId, teamName){
  const planDiv = document.getElementById(planDivId);
  planDiv.innerHTML="";
  ["center-circle","penalty-box-left","penalty-box-right","mid-line"].forEach(cls=>{
    const div=document.createElement("div"); div.className=cls; planDiv.appendChild(div);
  });
  const {data:positions} = await supabase.from('plans').select('*').eq('team',teamName);
  teamList.forEach((p,i)=>{
    const marker=document.createElement("div");
    marker.className="player-marker"; marker.textContent=i+1;
    marker.style.background=(teamName==="blue")?"#1565c0":"#fdd835";
    const nameTag=document.createElement("div"); nameTag.className="player-name"; nameTag.textContent=p.name; marker.appendChild(nameTag);
    const pos = positions.find(pos=>pos.player_index===i) || {x:Math.random()*(planDiv.clientWidth-35), y:Math.random()*(planDiv.clientHeight-35)};
    marker.style.left = pos.x+"px"; marker.style.top = pos.y+"px";
    let offsetX=0, offsetY=0;
    function startDrag(e){
      e.preventDefault();
      const clientX=e.touches?e.touches[0].clientX:e.clientX;
      const clientY=e.touches?e.touches[0].clientY:e.clientY;
      offsetX = clientX - marker.getBoundingClientRect().left;
      offsetY = clientY - marker.getBoundingClientRect().top;
      document.addEventListener('mousemove', dragMove);
      document.addEventListener('mouseup', stopDrag);
      document.addEventListener('touchmove', dragMove,{passive:false});
      document.addEventListener('touchend', stopDrag);
    }
    async function dragMove(e){
      e.preventDefault();
      const clientX=e.touches?e.touches[0].clientX:e.clientX;
      const clientY=e.touches?e.touches[0].clientY:e.clientY;
      let x=clientX-planDiv.getBoundingClientRect().left-offsetX;
      let y=clientY-planDiv.getBoundingClientRect().top-offsetY;
      x=Math.max(0, Math.min(x, planDiv.clientWidth-35));
      y=Math.max(0, Math.min(y, planDiv.clientHeight-35));
      marker.style.left=x+"px"; marker.style.top=y+"px";
      await supabase.from('plans').upsert([{team:teamName, player_index:i, x, y}]);
    }
    function stopDrag(){
      document.removeEventListener('mousemove', dragMove);
      document.removeEventListener('mouseup', stopDrag);
      document.removeEventListener('touchmove', dragMove);
      document.removeEventListener('touchend', stopDrag);
    }
    marker.addEventListener('mousedown', startDrag);
    marker.addEventListener('touchstart', startDrag,{passive:false});
    planDiv.appendChild(marker);
  });
}

async function renderAllPlans(){
  const {data:playersData} = await supabase.from('players').select('*');
  const blueTeam = playersData.filter(p=>p.team==="blue");
  const yellowTeam = playersData.filter(p=>p.team==="yellow");
  createPlan(blueTeam,"bluePlan","blue");
  createPlan(yellowTeam,"yellowPlan","yellow");
}
["INSERT","UPDATE","DELETE"].forEach(event=>{
  supabase.from('plans').on(event,()=>renderAllPlans()).subscribe();
});
renderAllPlans();
</script>
</body>
</html>
