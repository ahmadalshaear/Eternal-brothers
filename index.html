<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Eternal Brothers FC</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
<style>
/* --- ŸÜŸÅÿ≥ CSS ÿßŸÑŸÇÿØŸäŸÖ ŸÖÿπ ÿ®ÿπÿ∂ ÿßŸÑÿ™ÿπÿØŸäŸÑÿßÿ™ ÿßŸÑÿ®ÿ≥Ÿäÿ∑ÿ© --- */
body { font-family:"Cairo",Arial,sans-serif; background:#121212; color:#e0e0e0; padding:10px; text-align:center; margin:0;}
.nav-buttons { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;}
button { padding:10px 16px; border:none; font-weight:700; font-size:15px; border-radius:8px; cursor:pointer; width:30%; max-width:130px;}
#homeBtn { background:#d32f2f; color:#fff;}
#blueBtn { background:#1976d2; color:#fff;}
#yellowBtn { background:#fbc02d; color:#000;}
.container { max-width:95%; margin:auto; background:#1e1e1ecc; padding:20px 10px; border-radius:15px; box-shadow:0 0 10px #000; display:none;}
h1 { font-size:20px; color:#d32f2f; margin-bottom:5px; font-weight:bold;}
h1::before, h1::after { content:"‚öΩ"; margin:0 6px;}
h2 { font-size:20px; color:#fff; margin:15px 0 8px;}
input[type=text], input[type=time] { padding:10px; width:80%; margin:8px 0; border-radius:8px; border:1px solid #555; text-align:center; font-size:15px; background:#2c2c2c; color:#fff;}
button.addBtn { padding:8px 14px; margin:6px; font-size:14px; }
ul { list-style:none; padding:0; text-align:left; margin-top:10px; font-weight:bold; font-family:"Arial Black", Arial, sans-serif;}
li { margin:6px 0; padding:8px; border-radius:12px; font-size:15px; display:flex; justify-content:space-between; align-items:center;}
#teamList li { background:#a8e6a1; color:black;}
#waitingList li { background:#ffe0e0; color:black;}
#blueList li { background:rgba(25,118,210,0.7); color:black;}
#yellowList li { background:rgba(251,192,42,0.7); color:black;}
#chatBox { max-height:300px; overflow-y:auto; background:#2c2c2c; padding:10px; border-radius:8px; margin-bottom:10px; text-align:left;}
.message-time { font-size:12px; color:#aaa; margin-left:6px; }
.match-time { font-size:16px; margin:5px 0; color:#fff;}
.match-note { font-size:14px; margin:5px 0; color:#fdd835;}
.address-container { position: relative; display:inline-block; margin-bottom:15px;}
.address-pin { position:absolute; left:-25px; top:50%; transform:translateY(-50%); font-size:20px;}
#matchAddress { font-weight:bold; font-size:18px; cursor:pointer; user-select:none; color:#fff;}
.field { width:100%; max-width:400px; height:250px; background:#4CAF50; margin:10px auto 20px auto; border:2px solid #fff; border-radius:10px; position:relative; touch-action:none;}
.field::before { content:""; position:absolute; top:0; left:0; right:0; bottom:0; border:2px solid #fff; border-radius:10px;}
.field .center-circle, .field .penalty-box-left, .field .penalty-box-right, .field .mid-line { position:absolute; border:2px solid #fff; content:""; }
.field .center-circle { width:50px; height:50px; border-radius:50%; top:50%; left:50%; transform:translate(-50%,-50%);}
.field .penalty-box-left { width:60px; height:120px; top:50%; left:0; transform:translateY(-50%);}
.field .penalty-box-right { width:60px; height:120px; top:50%; right:0; transform:translateY(-50%);}
.field .mid-line { width:0; height:100%; border-left:2px solid #fff; top:0; left:50%; transform:translateX(-50%);}
.player-marker { width:35px; height:35px; border-radius:50%; color:#fff; display:flex; align-items:center; justify-content:center; font-size:14px; font-weight:bold; position:absolute; cursor:grab; user-select:none; text-align:center;}
.player-name { position:absolute; width:100px; text-align:center; left:-30px; top:-20px; font-size:12px; color:#fff;}
@media (max-width:500px){ button{width:28%; font-size:14px;} input[type=text], input[type=time]{width:90%; font-size:14px;} #matchAddress{font-size:16px;} }
</style>
</head>
<body>

<div class="nav-buttons">
  <button id="blueBtn" onclick="showSection('blue')">Blue</button>
  <button id="homeBtn" onclick="showSection('main')">Home</button>
  <button id="yellowBtn" onclick="showSection('yellow')">Yellow</button>
</div>

<div id="main" class="container">
  <h1>Eternal Brothers FC</h1>
  <div class="address-container">
    <span class="address-pin">üìç</span>
    <span id="matchAddress">Click here to set match address</span>
  </div>
  <div class="match-time">‚úîÔ∏è The match will be on Sunday at 9:40 AM</div>
  <div class="match-note">Please follow the group chat in case of any changes</div>

  <h2>Add Player to Main Team</h2>
  <input type="text" id="nameInput" placeholder="Enter player name">
  <button class="addBtn" onclick="addMember()">Add</button>

  <h2>Main Team List (24 players max)</h2>
  <ul id="teamList"></ul>

  <h2>Waiting List</h2>
  <ul id="waitingList"></ul>

  <h2>Team Chat</h2>
  <input type="text" id="chatName" placeholder="Enter your name to enable chat">
  <button class="addBtn" onclick="enableChat()">‚úîÔ∏è Confirm</button>
  <div id="chatBox"></div>
  <input type="text" id="chatInput" placeholder="Type your message..." style="width:80%;" disabled>
  <button class="addBtn" id="sendBtn" onclick="sendMessage()" disabled style="background:green;">Send</button>
  <button class="addBtn" style="background:#d32f2f; font-size:12px;" onclick="clearChat()">Clear Chat</button>
</div>

<div id="blue" class="container" style="background:#1565c0aa;">
  <h2>Blue Team üîµ</h2>
  <input type="text" id="blueInput" placeholder="Enter player name">
  <button class="addBtn" onclick="addBlue()">Add</button>
  <ul id="blueList"></ul>
  <h3>Blue Team Plan</h3>
  <div id="bluePlan" class="field"></div>
</div>

<div id="yellow" class="container" style="background:#fdd835aa; color:#000;">
  <h2>Yellow Team üü°</h2>
  <input type="text" id="yellowInput" placeholder="Enter player name">
  <button class="addBtn" onclick="addYellow()">Add</button>
  <ul id="yellowList"></ul>
  <h3>Yellow Team Plan</h3>
  <div id="yellowPlan" class="field"></div>
</div>

<audio id="sendSound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

const supabaseUrl = 'https://wihhlvgkjglphjzhivdn.supabase.co'
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndpaGhsdmdramdscGhqemhpdmRuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI5NDMwOTYsImV4cCI6MjA3ODUxOTA5Nn0.0uG2yhtSzNiGfn3f1ZjB0p33lMh75Et28aMgMGznWlQ'

const supabase = createClient(supabaseUrl, supabaseKey);

/* -------- Navigation -------- */
let currentTeamMusic = null;
function showSection(id){ document.querySelectorAll('.container').forEach(c=>c.style.display='none'); document.getElementById(id).style.display='block'; }
showSection('main');

/* -------- User Colors -------- */
const userColors={};
function getUserColor(name){ if(userColors[name]) return userColors[name]; const colors=["#2196F3","#FF9800","#4CAF50","#9C27B0","#00BCD4","#FFC107","#E91E63","#9E9E9E"]; const color=colors[Math.floor(Math.random()*colors.length)]; userColors[name]=color; return color; }

/* -------- Team & Chat Data -------- */
let team=[], waiting=[], blueTeam=[], yellowTeam=[], chatMessages=[], bluePlanPos=[], yellowPlanPos=[];

async function loadAll(){
  await Promise.all([loadTeam(), loadWaiting(), loadBlueTeam(), loadYellowTeam(), loadChat(), loadPlans()]);
}
async function loadTeam(){
  const { data, error } = await supabase.from('main_team').select('*').order('time');
  if(error) console.error(error); else team=data||[]; renderList('teamList',team,'black');
}
async function loadWaiting(){
  const { data, error } = await supabase.from('waiting_list').select('*').order('time');
  if(error) console.error(error); else waiting=data||[]; renderList('waitingList',waiting,'black');
}
async function loadBlueTeam(){
  const { data, error } = await supabase.from('blue_team').select('*').order('time');
  if(error) console.error(error); else blueTeam=data||[]; renderList('blueList',blueTeam,'black');
}
async function loadYellowTeam(){
  const { data, error } = await supabase.from('yellow_team').select('*').order('time');
  if(error) console.error(error); else yellowTeam=data||[]; renderList('yellowList',yellowTeam,'black');
}
async function loadChat(){
  const { data, error } = await supabase.from('chat').select('*').order('time');
  if(error) console.error(error); else chatMessages=data||[]; renderChat();
}
async function loadPlans(){
  const { data, error } = await supabase.from('blue_plan').select('*');
  if(!error) bluePlanPos = data||[];
  const { data: ydata, error:yerr } = await supabase.from('yellow_plan').select('*');
  if(!yerr) yellowPlanPos = ydata||[];
  renderAllPlans();
}

/* -------- Render List -------- */
function renderList(id,list,color="black"){ 
  document.getElementById(id).innerHTML=list.map((v,i)=>{
    const time=new Date(v.time).toLocaleString('en-US',{hour12:true});
    return `<li><span style="color:${color}">${i+1}. ${v.name} (${time})</span><span><span class="edit-btn" onclick="editPlayer('${id}',${i})">‚úèÔ∏è</span><span class="delete-btn" onclick="deletePlayer('${id}',${i})">üóëÔ∏è</span></span></li>`;
  }).join('');
}

/* -------- Add Player -------- */
async function addMember(){
  const name=document.getElementById('nameInput').value.trim(); if(!name) return alert("Name cannot be empty");
  const { data, error } = await supabase.from('main_team').insert([{ name, time:Date.now() }]);
  if(error) return alert(error.message);
  document.getElementById('nameInput').value="";
  await loadTeam();
}
async function addBlue(){
  const name=document.getElementById('blueInput').value.trim(); if(!name) return alert("Name cannot be empty");
  const { data, error } = await supabase.from('blue_team').insert([{ name, time:Date.now() }]);
  if(error) return alert(error.message);
  document.getElementById('blueInput').value="";
  await loadBlueTeam();
}
async function addYellow(){
  const name=document.getElementById('yellowInput').value.trim(); if(!name) return alert("Name cannot be empty");
  const { data, error } = await supabase.from('yellow_team').insert([{ name, time:Date.now() }]);
  if(error) return alert(error.message);
  document.getElementById('yellowInput').value="";
  await loadYellowTeam();
}

/* -------- Edit/Delete -------- */
async function editPlayer(listId,index){
  let newName=prompt("Edit player name:");
  if(!newName) return;
  newName=newName.trim();
  let table="";
  if(listId==="teamList") table="main_team";
  else if(listId==="waitingList") table="waiting_list";
  else if(listId==="blueList") table="blue_team";
  else if(listId==="yellowList") table="yellow_team";
  const id=(listId==="teamList"?team[index].id:listId==="waitingList"?waiting[index].id:listId==="blueList"?blueTeam[index].id:yellowTeam[index].id);
  const { error } = await supabase.from(table).update({ name:newName }).eq('id',id);
  if(error) alert(error.message);
  await loadAll();
}
async function deletePlayer(listId,index){
  if(!confirm("Delete this player?")) return;
  let table="", id;
  if(listId==="teamList"){ table="main_team"; id=team[index].id; }
  else if(listId==="waitingList"){ table="waiting_list"; id=waiting[index].id; }
  else if(listId==="blueList"){ table="blue_team"; id=blueTeam[index].id; }
  else if(listId==="yellowList"){ table="yellow_team"; id=yellowTeam[index].id; }
  const { error } = await supabase.from(table).delete().eq('id',id);
  if(error) alert(error.message);
  await loadAll();
}

/* -------- Chat -------- */
let chatEnabled=false;
function enableChat(){ 
  const name=document.getElementById('chatName').value.trim(); 
  if(!name) return alert("Please enter your name"); 
  chatEnabled=true; 
  document.getElementById('chatInput').disabled=false; 
  document.getElementById('sendBtn').disabled=false; 
}
async function sendMessage(){
  if(!chatEnabled) return alert("Enable chat first");
  const chatName=document.getElementById('chatName').value.trim();
  const text=document.getElementById('chatInput').value.trim();
  if(!text) return;
  const { error } = await supabase.from('chat').insert([{ name:chatName, text, time:Date.now() }]);
  if(error) alert(error.message);
  document.getElementById('chatInput').value="";
  await loadChat();
  document.getElementById('sendSound').play();
}
function renderChat(){
  const chatBox=document.getElementById('chatBox');
  chatBox.innerHTML="";
  chatMessages.forEach(m=>{
    const time=new Date(m.time).toLocaleString('en-US',{hour12:true});
    const color=getUserColor(m.name);
    const div=document.createElement('div');
    div.innerHTML=`<span style="color:${color}">${m.name}</span>: ${m.text} <span class="message-time">(${time})</span>`;
    div.style.padding='4px 2px';
    chatBox.appendChild(div);
  });
  chatBox.scrollTop=chatBox.scrollHeight;
}
document.getElementById('chatInput').addEventListener("keypress",function(e){if(e.key==="Enter") sendMessage();});
document.getElementById('chatName').addEventListener("keypress",function(e){if(e.key==="Enter") enableChat();});
function clearChat(){ if(!confirm("Clear chat?")) return; supabase.from('chat').delete(); chatMessages=[]; renderChat(); }

/* -------- Editable match address -------- */
const matchAddress=document.getElementById('matchAddress');
matchAddress.addEventListener('dblclick',()=>{ 
  const current=matchAddress.textContent; 
  const newText=prompt("Enter match address:",current); 
  if(newText!==null){ matchAddress.textContent=newText.trim()||"Click here to set match address"; }
});

/* -------- Draggable plans -------- */
function createPlan(teamList, planDivId, planPosArr, color){
  const planDiv=document.getElementById(planDivId);
  planDiv.innerHTML="";
  const centerCircle=document.createElement("div"); centerCircle.className="center-circle"; planDiv.appendChild(centerCircle);
  const pbLeft=document.createElement("div"); pbLeft.className="penalty-box-left"; planDiv.appendChild(pbLeft);
  const pbRight=document.createElement("div"); pbRight.className="penalty-box-right"; planDiv.appendChild(pbRight);
  const midLine=document.createElement("div"); midLine.className="mid-line"; planDiv.appendChild(midLine);

  teamList.forEach((p,i)=>{
    const marker=document.createElement("div"); marker.className="player-marker"; marker.textContent=i+1; marker.style.background=color;
    const nameTag=document.createElement("div"); nameTag.className="player-name"; nameTag.textContent=p.name; marker.appendChild(nameTag);
    const pos=planPosArr[i]||{x:Math.random()*(planDiv.clientWidth-35),y:Math.random()*(planDiv.clientHeight-35)};
    marker.style.left=pos.x+"px"; marker.style.top=pos.y+"px";
    let offsetX=0, offsetY=0;
    function startDrag(e){
      e.preventDefault();
      const clientX=e.touches?e.touches[0].clientX:e.clientX;
      const clientY=e.touches?e.touches[0].clientY:e.clientY;
      offsetX=clientX-marker.getBoundingClientRect().left;
      offsetY=clientY-marker.getBoundingClientRect().top;
      document.addEventListener('mousemove', dragMove);
      document.addEventListener('mouseup', stopDrag);
      document.addEventListener('touchmove', dragMove,{passive:false});
      document.addEventListener('touchend', stopDrag);
    }
    function dragMove(e){
      e.preventDefault();
      const clientX=e.touches?e.touches[0].clientX:e.clientX;
      const clientY=e.touches?e.touches[0].clientY:e.clientY;
      let x=clientX-planDiv.getBoundingClientRect().left-offsetX;
      let y=clientY-planDiv.getBoundingClientRect().top-offsetY;
      x=Math.max(0,Math.min(x,planDiv.clientWidth-35));
      y=Math.max(0,Math.min(y,planDiv.clientHeight-35));
      marker.style.left=x+"px";
      marker.style.top=y+"px";
      planPosArr[i]={x,y};
      // Save plan positions to Supabase
      const table=planDivId==="bluePlan"?"blue_plan":"yellow_plan";
      supabase.from(table).upsert([{ id:p.id, x, y }]);
    }
    function stopDrag(){
      document.removeEventListener('mousemove', dragMove);
      document.removeEventListener('mouseup', stopDrag);
      document.removeEventListener('touchmove', dragMove);
      document.removeEventListener('touchend', stopDrag);
    }
    marker.addEventListener('mousedown', startDrag);
    marker.addEventListener('touchstart', startDrag,{passive:false});
    planDiv.appendChild(marker);
  });
}
function renderAllPlans(){
  createPlan(blueTeam,"bluePlan",bluePlanPos,"#1565c0");
  createPlan(yellowTeam,"yellowPlan",yellowPlanPos,"#fdd835");
}

/* -------- Load all data -------- */
loadAll();
</script>
</body>
</html>
